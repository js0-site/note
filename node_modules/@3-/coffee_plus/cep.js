#!/usr/bin/env -S node --trace-uncaught --expose-gc --unhandled-rejections=strict --experimental-wasm-modules
var argv, compile, ext, outdir, run, watch;

import dir from './dir.js';

import {
  resolve
} from 'path';

import yargs from 'yargs/yargs';

import {
  hideBin
} from 'yargs/helpers';

argv = yargs(hideBin(process.argv)).alias('compile', 'c').describe('compile', 'compile file or dir').alias('outdir', 'o').describe('outdir', 'outdir dir').alias('ext', 'e').describe('ext', 'js / mjs').alias('watch', 'w').describe('watch', 'watch change').alias('run', 'r').describe('run', 'run command after watch change').parse();

({compile, outdir, watch, ext, run} = argv);

if (!compile) {
  compile = process.cwd();
}

compile = resolve(compile);

await dir(compile, outdir, ext || 'js');

if (watch) {
  ((await import('./watch.js'))).default(compile, outdir, run);
}
